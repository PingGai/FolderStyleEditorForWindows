<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="using:WindowsFolderStyleEditor_Avalonia"
        xmlns:views="using:WindowsFolderStyleEditor_Avalonia.Views"
        xmlns:vm="using:WindowsFolderStyleEditor_Avalonia.ViewModels"
        xmlns:services="using:WindowsFolderStyleEditor_Avalonia.Services"
        xmlns:controls="using:WindowsFolderStyleEditor_Avalonia.Controls"
        mc:Ignorable="d" d:DesignWidth="448" d:DesignHeight="816"
        x:Class="WindowsFolderStyleEditor_Avalonia.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="{Binding Source={x:Static services:LocalizationManager.Instance}, Path=[Window_Title]}"
        WindowStartupLocation="CenterScreen"
        CanResize="False"
        SystemDecorations="None"
        ShowInTaskbar="True"
        ExtendClientAreaToDecorationsHint="True"
        TransparencyLevelHint="AcrylicBlur"
        Background="Transparent"
        Width="448" Height="816"
        CornerRadius="{StaticResource RadiusXl}">
    
    <Grid DragDrop.AllowDrop="True">
        <!-- White Background Layer -->
        <Border CornerRadius="{StaticResource RadiusXl}" Background="White" />

        <!-- Animated Background Layer -->
        <Border CornerRadius="{StaticResource RadiusXl}" BoxShadow="{StaticResource Shadow2}">
            <Border.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                    <GradientStop Color="#24FF7474" Offset="0" />
                    <GradientStop Color="#1F74A1FF" Offset="1" />
                </LinearGradientBrush>
            </Border.Background>
            <Border.Styles>
                <Style Selector="Border">
                    <Style.Animations>
                        <Animation Duration="0:0:16" IterationCount="Infinite" PlaybackDirection="Alternate">
                            <KeyFrame Cue="0%">
                                <Setter Property="Background">
                                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                        <GradientStop Color="#24FF7474" Offset="0" />
                                        <GradientStop Color="#1F74A1FF" Offset="1" />
                                    </LinearGradientBrush>
                                </Setter>
                            </KeyFrame>
                            <KeyFrame Cue="50%">
                                <Setter Property="Background">
                                    <LinearGradientBrush StartPoint="100%,100%" EndPoint="0%,0%">
                                        <GradientStop Color="#2E74FFC7" Offset="0" />
                                        <GradientStop Color="#2EFFCB74" Offset="1" />
                                    </LinearGradientBrush>
                                </Setter>
                            </KeyFrame>
                            <KeyFrame Cue="100%">
                                <Setter Property="Background">
                                    <LinearGradientBrush StartPoint="0%,100%" EndPoint="100%,0%">
                                        <GradientStop Color="#24FF7474" Offset="0" />
                                        <GradientStop Color="#1F74A1FF" Offset="1" />
                                    </LinearGradientBrush>
                                </Setter>
                            </KeyFrame>
                        </Animation>
                    </Style.Animations>
                </Style>
            </Border.Styles>
        </Border>

        <!-- Main Content Grid -->
        <Grid>
            <views:HomeView Name="HomeView" ZIndex="1" />
            <views:EditView Name="EditView" IsVisible="False" ZIndex="0" />
        </Grid>
        
        <!-- Drag and Drop Indicator -->
        <Rectangle Name="DragDropIndicator"
                   IsVisible="{Binding IsDragOver}"
                   StrokeThickness="2"
                   RadiusX="24"
                   RadiusY="24"
                   Margin="8"
                   IsHitTestVisible="False">
            <Rectangle.Stroke>
                <SolidColorBrush Color="LightGray" Opacity="0.7"/>
            </Rectangle.Stroke>
        </Rectangle>

        <!-- Release to Apply Tip -->
        <Border IsVisible="{Binding IsDragOver}"
                VerticalAlignment="Top"
                HorizontalAlignment="Center"
                Margin="0,80,0,0"
                Background="#A0FFFFFF"
                CornerRadius="999"
                Padding="16,8"
                IsHitTestVisible="False">
            <TextBlock Text="{Binding Source={x:Static services:LocalizationManager.Instance}, Path=[Drag_ReleaseToApply]}" Foreground="{StaticResource Fg2Brush}" FontWeight="SemiBold"/>
        </Border>

        <!-- Drag Adorner -->
        <Canvas Name="DragAdornerCanvas" IsHitTestVisible="False">
            <PathIcon Name="DragIcon"
                      IsVisible="{Binding IsDragOver}"
                      Data="{Binding DragIconData}"
                      Canvas.Left="{Binding DragIconX}"
                      Canvas.Top="{Binding DragIconY}"
                      Width="24" Height="24"
                      Foreground="{StaticResource Fg2Brush}"/>
        </Canvas>

        <views:Toast DataContext="{Binding}" ZIndex="999"/>

       <!-- Language Switch Button -->
       <Button x:Name="LanguageButton" Classes="Btn BtnGhost"
               VerticalAlignment="Bottom"
               HorizontalAlignment="Right"
               Margin="0,0,18,18"
               Width="38" Height="38"
               Click="LanguageButton_OnClick"
               ZIndex="998">
           <ToolTip.Tip>
               <TextBlock Text="Language / 语言"/>
           </ToolTip.Tip>
            <controls:LanguagesIcon Foreground="{StaticResource Fg2Brush}" Width="20" Height="20" Opacity="0.6"/>
       </Button>

        <!-- Language Popup Menu -->
        <Popup x:Name="LanguagePopup"
               PlacementTarget="{Binding #LanguageButton}"
               IsLightDismissEnabled="True"
               Placement="TopEdgeAlignedRight"
               HorizontalOffset="8"
               VerticalOffset="-8">
            <views:LanguageMenuView/>
        </Popup>
   </Grid>
</Window>
