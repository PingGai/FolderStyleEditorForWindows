# Changelog

## v0.1.11-rev.5 - 优化滚动指示器 - 2025-12-24

- feat: 优化滚动条显示逻辑，仅在滚动或悬停于滚动条时显示，闲置2秒后自动渐隐 (含防误触延迟)

## v0.1.11-rev.4 - 窗口最小化细节优化 - 2025-12-24

- feat: 实现窗口渐入渐出动画，包括启动时的渐入动画和关闭时的渐出动画，提升用户体验。

## v0.1.11-rev.3 - 优化选择器样式 - 2025-12-24

- style: 将Edit页面的icon选择器的ListBoxItem的CornerRadius属性设置为9,9,9,9，以提升视觉一致性和美观度。

## v0.1.11-rev.2 - 悬停提示视觉与动画修复 - 2025-12-4

- fix: 通过将样式内联到Popup的Border控件，并结合async/await事件处理器，彻底解决了悬停提示的视觉效果和动画问题。
- fix: 修复了悬停提示在语言切换时不是实时生效的问题。
- fix: 修复了悬停提示闪烁的问题。

## v0.1.11-rev.1 - 图标设置与别名设置细节修复 - 2025-12-03

- fix: 修复了当拖拽 .ico 文件到文件夹编辑页面时，系统将绝对路径直接写入 desktop.ini 的问题。现在 .ico 文件会被正确复制到 .ICON 目录并使用相对路径引用。
- feat: 别名输入框现在支持拖拽文本内容，当拖拽文本并悬停在别名输入框上松手时，可以替换掉别名框内的文字，并与撤回功能兼容。
- feat: 实现别名长度验证功能，当别名长度 ≥ 260 时显示红色警告（#FFFF5555），< 260 时恢复正常颜色。

---

## v0.1.10-rev.3 - 撤回队列与提示修复 - 2025-12-02

- feat: 编辑页面支持 Ctrl+Z 撤回，别名与图标共用同一撤回队列，并按文件夹维度记忆，切换后返回仍可继续撤回（会话内驻留）。
- fix: 标题栏置顶与语言按钮悬停提示不可见问题，改为独立弹层确保提示稳定显示。
- chore: 初始化加载时关闭撤回记录，避免首次加载/切换文件夹误入撤回栈。

## v0.1.10-rev.2 - 图标扫描渐进交互 - 2025-12-02

- feat: 自动获取图标改为渐进扫描，超过 1s 会先展示已找到的结果并持续更新，扫描完成前分母显示 ???。
- feat: 图标计数器改为文本态显示，悬停提示“滚轮滚动”并轻微放大，滚轮可循环切换，点击可内联输入跳转。
- fix: 单个图标文件目录下自动获取时的崩溃与未收敛索引，循环切换再次回到第一个图标。
- chore: 扫描过程中针对异常文件增加保护，避免 HasIcon 检查抛出导致扫描中断。
- fix: 置顶/语言按钮悬停提示被遮挡的问题，改用独立弹层确保提示可见，计数器提示同步可见。
- perf: 图标提取改为串行队列处理，快速滚轮切换时不再触发多重加载导致卡顿或未响应。

## v0.1.10-rev.1 - 阻断浮窗与历史确认 - 2025-12-02

- feat: 新增可复用的阻断式浮窗组件，支持遮罩、进度条、双按钮、参数化配色与淡入淡出+缩放动画，可供脚本随时调用
- feat: 首页“清除历史”操作接入阻断弹窗确认，默认文案走 i18n，确认后安全清理历史记录
- style: 调整浮窗配色为白底+淡红主按钮，优化渐变与透明度以贴合桌面风格
- style: 标题栏按钮新增阴影，提升可点击视觉反馈

---

## v0.1.9-rev.2 - 置顶指示器 - 2025-12-02

- feat: 置顶按钮图标现在会根据窗口的置顶状态在 `pin-off.svg` 和 `pin.svg` 之间动态切换。
- chore: 扩展了 `config.toml` 中的 `[PinIcon]` 配置，增加了 `PinnedIcon` 和 `UnpinnedIcon` 字段来分别管理两种状态下的图标路径。
- chore: 根据项目当前状态，移除了已废弃的悬停图标（HoverIcon）相关逻辑。
- fix: 修复了语言切换按钮和置顶按钮背景颜色过于淡的问题

## v0.1.9-rev.1 - 编辑界面支持按F2快速改名 - 2025-12-02

- feat: 在编辑界面按下F2快捷键，可快速聚焦到别名输入框并全选内容
- feat: 在别名输入框中按回车键可触发保存操作
- fix: 修复了包含环境变量（如 %SystemRoot%）的图标路径无法被正确解析的问题
- fix: 修复了从历史记录进入编辑页面时，如果图标路径与上次相同，图标选择器不会重新加载的问题
- fix: 强制重新加载文件夹设置，解决了从历史记录重复进入同一文件夹时，图标列表无法加载的根本问题

---

# 旧版更新日志 (Old Changelog)

V0.1.8-beta.2 - 鼠标悬停icon - 已更新
    + 在主窗口右下角新增“置顶切换”按钮（位于语言切换按钮左侧），点击切换窗口置顶状态；保留双击空白处置顶功能并提供悬停提示。
    + 新增并接入 i18n：`Pin_Tip_DoubleClickHint`（中/英）。
    + 使用 SVG 渲染 Pin 图标，路径来自配置 `PinIcon.MainIcon`；样式参考语言切换图标（Ghost）。
    + 默认关闭 Debug 覆盖层（[Debug].EnableOverlay=false）。
    + 通过 dotnet build 验证，支持脚本打包（build/build.ps1）。

V0.1.8-beta.1 - 调试功能与SVG渲染修复 - 已更新
    + 新增了一个全局调试覆盖层 (`DebugOverlay`)，用于在界面上显示实时的调试信息。
    + 在 `config.toml` 中增加了 `[Debug]` 配置部分，允许通过开关控制调试层的显示以及其中各个组件的可见性。
    + 引入了 `Svg.Controls.Skia.Avalonia` NuGet 包，并使用 `SvgImage` 替换了原有的 `PathIcon` 方案，为正确渲染 SVG 图标奠定了基础。
    + 在调试层中添加了独立的 SVG 和 PNG 渲染测试组件，以验证基本图像的渲染能力。
    + 对 `ConfigManager` 进行了重构，统一了配置加载逻辑，使其能够正确解析新的调试选项。
    + 创建了相关的 `DebugConfig` 模型和 `DebugOverlayViewModel` 视图模型来支持新的调试功能。
    + 在 OpenSpec 中创建了 `add-debug-overlay` 变更提案，并撰写了 `svg-rendering-guide.md` 文档。
    + 调整 `MainWindow` 中调试覆盖层的锚定方式（左下角 Grid 对齐，常驻测量）并将根容器设置为不可命中，确保层级和输入安全。
    + 更新 `DebugOverlay` XAML：切换到 `Svg.Controls.Skia.Avalonia` 命名空间、提供统一 32×32 最小尺寸、PNG 插值及 HoverIcon 克隆占位，同时支持背景色绑定。
    + 扩展 `DebugConfig` 与 `config.toml`，新增 `HoverIconBgColor` 默认值，并在 `DebugOverlayViewModel` 中生成可降级的背景画刷。
    + 修正 SVG 控件命名空间为 `Avalonia.Svg.Skia` 并加入 `SvgImage`/`Svg` 推荐写法，确保编译器正确识别类型。
    + 在 `Program.cs` 的 `BuildAvaloniaApp()` 中引入 `SvgImageExtension`/`Svg` 的 `GC.KeepAlive`，保证设计器和编译期加载依赖。
    + DebugOverlay 默认开关调整为开启状态，同时修正 SVG/PNG 测试资源的 `avares://FolderStyleEditorForWindows/...` 路径并新增 `[Debug]` 配置项可覆盖测试资源路径；SVG 统一应用 75% 透明度并增强 CSS `currentColor` 着色，PNG 测试图改为通过 `AssetLoader` 载入确保资源可见。
    + `dotnet build` 成功通过，验证 DebugOverlay 最小链路可编译。
    + `LocalizationManager` 新增系统语言自动匹配逻辑：仅在用户未手动选择语言时根据 `[LanguageDefaults]` 列表匹配中文/英文/默认文化，并记录 `LanguageConfigured` 避免后续被覆盖。
    + `Appearance.SvgOpacityMaskColor` 配置项接入全局 `Svg` 样式，保证 SVG 透明度在不同背景下表现一致。
    + 编写 `开发记录/ask-svg-color-remote.md`，用于向可联网的 GPT 提交 SVG 颜色调试问题并附带现状说明。
    + 更新了 `build\build.ps1`构建脚本

V0.1.7-beta.2 - Toast样式微调 - 更新前的提示
    + UI-Fix: 移除了Toast通知的 `BoxShadow`，使其外观更简洁。

V0.1.7 - UI图标重构与i18n规范 - 已更新
    + UI重构: 将标题栏按钮（关闭、最小化、返回）重构为可复用的 `TitleBarButton` 样式，统一了代码并修复了 Padding 不一致的问题。
    + 资源集中化: 将按钮图标的路径数据提取为 `Icons.axaml` 中的 `StreamGeometry` 资源，提高了可维护性。
    + 规范更新: 在 `openspec/project.md` 中补充了国际化（i18n）开发规范，要求所有面向用户的文本都必须通过 `LocalizationManager` 进行管理。

V0.1.6-beta.2 - 窗口置顶（Pin） - 已更新
    + 双击窗口可以实现置顶功能
    + 修改了Toast样式（版本1，之后还会进行更多的修改，现在样式还是有点丑陋）
    + 尝试增加鼠标悬停提示但是失败了，将在下个版本更新
    + 这个版本不会提供Release

V0.1.6-beta.1 - 悬停图标、Toast修复与国际化
    + 悬停/拖拽图标: 实现了一个可跟随鼠标的复合图标，用于显示拖拽文件状态和窗口置顶状态。
    + Toast阴影修复: 解决了全局Toast通知阴影被父容器裁剪的问题。
    + 窗口置顶功能: 实现双击窗口空白处将窗口置顶的功能。
    + 国际化 (i18n): 将所有硬编码的Toast提示信息迁移至语言文件。
    + 配置文件系统: 引入并完善 `config.toml` 以统一管理新功能的所有配置。

V0.1.6 - 悬停图标与窗口置顶
    + 悬停/拖拽图标: 在鼠标悬停或拖拽文件时，在光标旁实时渲染一个复合图标（主图标+角标），提供即时视觉反馈。
    + 窗口置顶 (Pin): 支持通过双击窗口空白处，将应用窗口固定在所有其他窗口的最前端。
    + 全局通知服务: 重构了原有的“保存成功”提示，将其升级为一个可配置、可全局调用的 `Toast` 通知服务，并支持自定义颜色。
    + 配置文件系统: 引入了 `config.toml` 作为全局配置文件，用于管理新功能的参数，如双击阈值、图标路径等。

V0.1.5 - 性能优化与修复
    + GPU占用现在降低为原本的1/10
    + 性能诊断：在主窗口中实现了分层 A/B 测试机制，并添加了 FPS 和重绘区域的调试叠加层，以便精确诊断性能瓶颈。
    + 渲染优化：将背景流光动画从 XAML 迁移到 C#，并引入 FrameLimiter（帧率限制器），将动画更新频率限制在 60fps，显著降低了高刷新率显示器下的 GPU/CPU 占用。
    + 平台配置：明确配置了 Win32 平台的渲染模式和合成模式，优先使用硬件加速，确保应用在 Windows 上以最高效的方式运行。
    + 性能修复：通过实现 `IDisposable` 模式，并采取“销毁再重建”的策略来管理编辑视图，彻底解决了因 GPU 资源泄漏导致的性能占用在进入编辑页后永久性升高的问题。

V0.1.4 - 编辑页面交互修复与架构文档
    + 功能修复：通过在主窗口实现全局指针事件处理，彻底解决了点击窗口空白区域时输入框无法失去焦点的问题。
    + 功能优化：优化了输入框逻辑，现在只有当输入框内容为空且失去焦点时，其值才会恢复为默认值，改善了用户输入体验。
    + 项目维护：创建了 openspec/ui-architecture.md 文档，对项目的UI层级、视图关系和事件处理进行了梳理，为未来开发提供支持。

V0.1.3 - 核心修复与功能新增
    - 图标保存策略: 修复了 `desktop.ini` 中 `IconResource` 键覆盖 `IconFile` 键导致图标不生效的根本性问题。现在，程序会根据图标源智能写入正确的键值对，确保本地提取的图标被优先使用。
    - 图标提取引擎: 集成了基于 `RT_GROUP_ICON` 资源解析的 `IconExtractor`，并支持按索引提取特定图标组，彻底解决了图标颜色失真、透明度错误和方向不正确的问题。
    - 文件拖拽行为: 修复了拖拽文件会错误改变编辑目录的问题。现在，拖拽文件只会更新当前文件夹的图标，行为与手动选择文件一致。
    - 多图标预览: 恢复了对 `.ico` 文件和 `.exe`/`.dll` 文件中所有独立图标的完整预览功能。
    + 文件类型支持: 在编辑页面的“选择图标”功能中，新增了对 `.exe` 和 `.dll` 文件的支持。

V0.1.2 - 项目图标与文档优化
    + 项目图标: 为应用程序添加了新的、更精细的图标 (`FSM_Image_Multi.ico`)，提升了品牌辨识度。
    + 英文 README: 创建了 `README.en-US.md`，提供完整的英文文档，并通过语言切换链接与中文版互联。
    + README 布局: 优化了 `README.md` 的布局，将项目 Logo 居中置于顶部，并美化了图片标题的排版，使其更具可读性和专业性。

V0.1.1 - 功能与流程优化
    + 集成 OpenSpec 工作流 (`openspec/`)
    + 填充项目上下文 `project.md`
    + 将项目重命名为 `FolderStyleEditorForWindows`
    + 更新 `.gitignore`

V0.1.0 - 首个发布版本
    + 第一个发布版本
    + 创建README.md
    + 整理和开源协议有关部分

V0.0.36 临时目录迁移与语言默认
    + 将 history.json 与语言等配置统一写入 %Temp%\WindowsFolderStyleEditor
    + 首次启动识别系统语言，简体/繁体默认 zh-CN，其他默认 en-US
    + 记录语言切换状态到临时配置目录
    - 移除在当前目录生成 history.json 的行为

V0.0.35 给窗口关闭和最小化增加动画
    +关闭动画
    +打开动画
    +最小化动画
    +从最小化放大动画

V0.0.34 修复无法修改权限不足的文件夹 & 快捷键保存
    + 遇到管理员权限目录自动发起提权并继续修改
    + 编辑界面支持 Ctrl+S 等价于“保存”（暂未实现）

V0.0.33 语言切换弹出菜单交互修复
    + 读取 lang 中语言自定义名并显示（代号置于括号）
    + 悬停透明度从50%过渡至85%（作用于上层容器）
    - 取消语言列表容器不必要的悬停动画
    - 收紧展开区域高度约10%以改善密度

V0.0.32 重置图标与清除样式一键归位
    + “重置图标/清除所有样式”统一置为 C:\WINDOWS\System32\SHELL32.dll,4
    - 清除样式时同时清空别名

V0.0.31 最近编辑卡片阴影截断问题
    + 将按钮直接置于可滚动列表内以完整渲染阴影
    - 移除多余中间容器避免裁剪

V0.0.30 最近编辑路径与标签显示优化
    + 新增“正在编辑目录”跑道形标签并固定右侧展示
    + 达到最大宽度时启用右向左白色渐变增强可读性
    - 左侧路径文本截断到标签起点，超长名左侧裁切

V0.0.29 优化默认体验：仅改别名不改图标
    + 保持文件夹图标为文件夹图标（SHELL32.dll,4）
    - 纠正初始值误设导致图标变“文件”的问题

V0.0.28 语言菜单背景可读性修复
    + 语言项按钮添加25%白色半透明底
    - 避免牵连重构，仅限局部样式修改

V0.0.27 悬停动画边界条件修复
    + 调整“点击选择文件夹”与标题的悬停交互不互相干扰
    - 取消影响回缩的无关缩放触发

V0.0.26 图标选择器与引用逻辑修复
    + 恢复一行容纳5个图标的布局
    - 排除 shell32.dll 拷贝进 .ICON，系统库走绝对路径

V0.0.25 主标题布局与文案修正
    + 合并为完整句式并实现水平/垂直居中
    + 编译运行自检通过

V0.0.24 语言选择器优化与滚动选择
    + 语言文件顶部支持“语言名称自定义”，列表显示“名称 (代号)”
    + 支持平滑滚动与编译后联调测试

V0.0.23 相对路径写入 desktop.ini
    + 文件位于当前目录时写入相对路径（不含盘符）
    + 不在当前目录则移动至隐藏 .ICON 并引用相对路径

V0.0.22 保存反馈与资源管理器刷新
    + 保存后显示白色半透明跑道形“保存成功”提示
    + 调用 SHChangeNotify 强制刷新图标显示

V0.0.21 完成编辑页大图标选择器
    + 图标库四行高、横向滚轮滑动、编号标识齐全
    - 摒弃直接套用 demo.html 的 Web 实现

V0.0.20 页面切换闪烁与自动取图标
    + 修复主页↔编辑页动画结束瞬间闪烁
    + 新增“自动获取图标”并按优先级轮换展示（子进程检索）

V0.0.19 支持拖拽文件夹到窗口
    + 顶层透明层与动态色层均可接收拖拽路径
    - 不影响现有交互命中区域

V0.0.18 首启落到主页面
    + 修复初次启动直接进入编辑页的问题
    + 中文交流与实现备注整理

V0.0.17 首启落到主页面（重复问题归并）
    + 统一路由初始化逻辑，仅在选择目录后进入编辑页
    - 移除历史绕路代码

V0.0.16 UI细节与交互修缮（I）
    + 按钮/输入/板块补全阴影与状态
    + 选择目录/图标弹出系统选择器
    + 标题/返回/最小化/关闭图标上下居中
    + 最近编辑使用统一样式并可直达编辑页

V0.0.15 UI细节与交互修缮（II）
    + 保存文字真正居中；最近编辑悬停轻微变暗
    + 打开资源管理器/属性按钮恢复按钮态
    - 去除系统主题色导致的违和高亮

V0.0.14 MainWindow 动画与代码修正
    + 完成构造函数闭合与 Transform 目标修正
    + AnimateIn/Out 基于 Transform.XProperty 正确运作

V0.0.13 主页白色衬底恢复
    + 将窗口底层背景恢复为纯白以衬托流光层
    - 纠正半透明层误置导致的穿透

V0.0.12 主页背景与功能细节合订修
    + 默认 IconResource 缺失时写入 SHELL32.dll,3 与 ViewState
    + 别名与文件夹名相同则清理 LocalizedResourceName
    + 最近编辑可点击、悬停轻暗化
    - 关闭/最小化按钮失效问题修复

V0.0.11 通过 msbuild 编译并清错
    + 跑通 msbuild，逐条修复编译报错直至可运行
    - 移除不合规调用与无用依赖

V0.0.10 拖拽与主页面选择重构
    + 重建拖拽接收与空白点击选择目录流程
    - 移除遮挡阴影的隐形容器，历史卡片阴影正常渲染

V0.0.9 基础 UI 比例布局搭建
    + 依据设计稿用比例实现窗口与主要区域栅格
    - 预留后续精准像素级微调入口

V0.0.8 严格对标 UI 设计
    + 统一圆角、模糊、流光、层级与间距
    - 对无法一比一实现处做兼容并记录至“无法实现.txt”

V0.0.7 读取项目设计与问题清单
    + 通读带书名号文档并输出问题汇总
    - 标注风险与改造优先级

V0.0.6 测试与调试跑通
    + 用指定 MSBuild 路径完整测试与 Debug
    + 校验需求书与代码方向一致性并修正

V0.0.5 通读《WindowsFolderStyleEditor》
    + 提炼核心需求、页面结构、关键交互
    - 形成后续实现与验收清单

V0.0.4 终端上传与 Git 初始化
    + 创建仓库、初始化忽略与分支策略
    - 规范提交信息与版本流

V0.0.3 初版需求阅读与分析
    + 读取《WindowsFolderStyleEditor》并形成实现笔记
    - 标注先决条件与外部依赖

V0.0.2 分析《WindowsFolderStyleEditor》可行性

V0.0.1 新建项目
