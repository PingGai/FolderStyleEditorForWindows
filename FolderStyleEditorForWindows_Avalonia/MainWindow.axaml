<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="using:FolderStyleEditorForWindows"
        xmlns:views="using:FolderStyleEditorForWindows.Views"
        xmlns:vm="using:FolderStyleEditorForWindows.ViewModels"
        xmlns:services="using:FolderStyleEditorForWindows.Services"
        xmlns:controls="using:FolderStyleEditorForWindows.Controls"
        xmlns:svg="clr-namespace:Avalonia.Svg.Skia;assembly=Svg.Controls.Skia.Avalonia"
        mc:Ignorable="d" d:DesignWidth="448" d:DesignHeight="816"
        x:Class="FolderStyleEditorForWindows.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="{Binding Source={x:Static services:LocalizationManager.Instance}, Path=[Window_Title]}"
        WindowStartupLocation="CenterScreen"
        CanResize="False"
        SystemDecorations="None"
        ShowInTaskbar="True"
        ExtendClientAreaToDecorationsHint="True"
        TransparencyLevelHint="AcrylicBlur"
        Background="Transparent"
        Width="448" Height="816"
        CornerRadius="{StaticResource RadiusXl}">

   <Grid DragDrop.AllowDrop="True" PointerExited="MainWindow_PointerExited">
        <!-- White Background Layer -->
        <Border x:Name="BaseLayer" CornerRadius="{StaticResource RadiusXl}" Background="White" />

        <!-- Animated Background Layer -->
        <Border x:Name="FlowLayer" CornerRadius="{StaticResource RadiusXl}" BoxShadow="{StaticResource Shadow2}">
            <Border.Background>
                <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                    <GradientStop Color="#24FF7474" Offset="0" />
                    <GradientStop Color="#1F74A1FF" Offset="1" />
                </LinearGradientBrush>
            </Border.Background>
        </Border>

        <!-- Main Content Grid -->
        <Grid x:Name="CardsLayer">
            <views:HomeView Name="HomeView" ZIndex="1" />
            <views:EditView Name="EditView" IsVisible="False" ZIndex="0" />
        </Grid>
        
        <!-- Drag and Drop Indicator -->
        <Rectangle Name="DragDropIndicator"
                   IsVisible="{Binding IsDragOver}"
                   StrokeThickness="2"
                   RadiusX="24"
                   RadiusY="24"
                   Margin="8"
                   IsHitTestVisible="False">
            <Rectangle.Stroke>
                <SolidColorBrush Color="LightGray" Opacity="0.7"/>
            </Rectangle.Stroke>
        </Rectangle>

        <!-- Release to Apply Tip -->
        <Border IsVisible="{Binding IsDragOver}"
                VerticalAlignment="Top"
                HorizontalAlignment="Center"
                Margin="0,80,0,0"
                Background="#A0FFFFFF"
                CornerRadius="999"
                Padding="16,8"
                IsHitTestVisible="False">
            <TextBlock Text="{Binding Source={x:Static services:LocalizationManager.Instance}, Path=[Drag_ReleaseToApply]}" Foreground="{StaticResource Fg2Brush}"/>
        </Border>

        <!-- Drag Adorner -->
        <Canvas Name="DragAdornerCanvas" IsHitTestVisible="False">
            <PathIcon Name="DragIcon"
                      IsVisible="{Binding IsDragOver}"
                      Data="{Binding DragIconData}"
                      Canvas.Left="{Binding DragIconX}"
                      Canvas.Top="{Binding DragIconY}"
                      Width="24" Height="24"
                      Foreground="{StaticResource Fg2Brush}"/>
        </Canvas>

        <views:HoverIconAdorner DataContext="{Binding HoverIcon}" ZIndex="1000"/>
        <ItemsControl ItemsSource="{Binding Toasts}"
                      VerticalAlignment="Top"
                      Margin="0,20,0,0"
                      HorizontalAlignment="Center"
                      ZIndex="999">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel Spacing="10"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <views:Toast />
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

       <!-- Bottom Right Buttons -->
       <StackPanel x:Name="ActionButtonsPanel"
                   Orientation="Horizontal"
                   VerticalAlignment="Bottom"
                   HorizontalAlignment="Right"
                   Margin="0,0,18,18"
                   Spacing="10"
                   ZIndex="998">
           <!-- Pin Toggle Button -->
            <Button x:Name="PinButton"
                    Classes="Btn BtnGhost"
                    Width="38" Height="38"
                    Click="PinButton_OnClick"
                    PointerEntered="PinButton_PointerEntered"
                    PointerExited="PinButton_PointerExited">
                <svg:Svg x:Name="PinButtonIcon" Width="20" Height="20" Opacity="0.4"
                         Css="{DynamicResource SvgCss}" />
            </Button>

            <!-- Language Switch Button -->
            <Button x:Name="LanguageButton" Classes="Btn BtnGhost"
                    Width="38" Height="38"
                    Click="LanguageButton_OnClick"
                    PointerEntered="LanguageButton_PointerEntered"
                    PointerExited="LanguageButton_PointerExited">
                <controls:LanguagesIcon Foreground="{StaticResource Fg2Brush}" Width="20" Height="20" Opacity="0.6"/>
            </Button>
        </StackPanel>

        <!-- Tooltip Popups -->
        <Popup x:Name="PinToolTipPopup" IsHitTestVisible="False" Placement="Bottom" Opacity="0">
            <Popup.Transitions>
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0.15" Easing="CubicEaseOut"/>
                </Transitions>
            </Popup.Transitions>
            <Border Background="#F7F7F7"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="8,4"
                    BoxShadow="0 2 8 0 #20000000">
                <TextBlock x:Name="PinToolTipTextBlock"
                           Text="{Binding Source={x:Static services:LocalizationManager.Instance}, Path=[Pin_Tip_DoubleClickHint]}"
                           Foreground="#212121"
                           FontSize="12"/>
            </Border>
        </Popup>

        <Popup x:Name="LangToolTipPopup" IsHitTestVisible="False" Placement="Bottom" Opacity="0">
            <Popup.Transitions>
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0.15" Easing="CubicEaseOut"/>
                </Transitions>
            </Popup.Transitions>
            <Border Background="#F7F7F7"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="8,4"
                    BoxShadow="0 2 8 0 #20000000">
                <TextBlock x:Name="LangToolTipTextBlock"
                           Text="{Binding Source={x:Static services:LocalizationManager.Instance}, Path=[Language_Tip]}"
                           Foreground="#212121"
                           FontSize="12"/>
            </Border>
        </Popup>

         <!-- Language Popup Menu -->
         <Popup x:Name="LanguagePopup"
                PlacementTarget="{Binding #LanguageButton}"
                IsLightDismissEnabled="True"
                Placement="TopEdgeAlignedRight"
                HorizontalOffset="8"
                VerticalOffset="-8">
             <views:LanguageMenuView/>
         </Popup>

        <!-- Debug Overlay -->
        <Border HorizontalAlignment="Left"
                VerticalAlignment="Bottom"
                Margin="12"
                ZIndex="9000"
                IsHitTestVisible="False"
                MinWidth="32"
                MinHeight="32"
                IsVisible="{Binding DebugOverlay.IsEnabled}">
            <views:DebugOverlay DataContext="{Binding DebugOverlay}"/>
        </Border>

        <views:InterruptDialog DataContext="{Binding InterruptDialog}" ZIndex="12000"/>
   </Grid>
</Window>
